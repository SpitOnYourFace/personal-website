---
import { ViewTransitions } from 'astro:transitions';

interface Props {
  title: string;
  description?: string;
}

const { title, description = "Krasimir Kralev — Web Developer & QA Specialist" } = Astro.props;
const ogImage = "/images/og-image.png";
const siteUrl = "https://krasimirkralev.com";
---

<!doctype html>
<html lang="en" data-lang="en" translate="no">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={description} />
    <meta name="google" content="notranslate" />
    <title>{title}</title>

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />

    <!-- Theme color for mobile browsers -->
    <meta name="theme-color" content="#0c0c1d" media="(prefers-color-scheme: dark)" />
    <meta name="theme-color" content="#faf8f5" media="(prefers-color-scheme: light)" />

    <!-- Canonical -->
    <link rel="canonical" href={siteUrl} />

    <!-- Open Graph -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={siteUrl} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={`${siteUrl}${ogImage}`} />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={`${siteUrl}${ogImage}`} />

    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json" set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "Krasimir Kralev",
      "url": siteUrl,
      "jobTitle": "QA & Development Specialist",
      "worksFor": { "@type": "Organization", "name": "ResultsCX" },
      "alumniOf": { "@type": "CollegeOrUniversity", "name": "University of Plovdiv" },
      "sameAs": [
        "https://github.com/SpitOnYourFace",
        "https://www.facebook.com/share/1Cyiz9qXq4/",
        "https://www.youtube.com/channel/UCtA80N1APoWs2ELq8udQHpA"
      ]
    })} />

    <!-- Fonts: preload critical + async load full set -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      rel="preload"
      as="style"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;700&display=swap"
      onload="this.onload=null;this.rel='stylesheet'"
    />
    <noscript>
      <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;700&display=swap"
        rel="stylesheet"
      />
    </noscript>

    <!-- Theme + Language detection — runs before body to prevent flash -->
    <script is:inline>
      (function() {
        var lang = localStorage.getItem('lang');

        // Auto-detect language from browser if not set by user
        if (!lang) {
          var browserLang = navigator.language || navigator.userLanguage;
          // Check if browser language is Bulgarian
          if (browserLang.toLowerCase().startsWith('bg')) {
            lang = 'bg';
          } else {
            lang = 'en';
          }
          // Save the detected language
          localStorage.setItem('lang', lang);
        }

        document.documentElement.lang = lang;
        document.documentElement.dataset.lang = lang;

        var theme = localStorage.getItem('theme');
        if (!theme) {
          theme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        }
        if (theme === 'dark') {
          document.documentElement.classList.add('dark');
        }
      })();
    </script>

    <style is:global>
      html[data-lang="en"] [data-lang="bg"] { display: none !important; }
      html[data-lang="bg"] [data-lang="en"] { display: none !important; }
    </style>

    <ViewTransitions />
  </head>
  <body class="bg-surface text-primary font-sans text-base leading-relaxed overflow-x-hidden antialiased" style="transition:background-color 0.3s,color 0.3s">
    <!-- Skip navigation -->
    <a href="#main-content" class="skip-nav">
      <span data-lang="en">Skip to content</span>
      <span data-lang="bg">Към съдържанието</span>
    </a>

    <!-- Scroll progress bar -->
    <div id="scroll-progress"></div>

    <slot />

    <!-- Console greeting -->
    <script is:inline>
      console.log('%c Hey there, fellow developer!', 'font-size: 20px; font-weight: bold; color: #c8973e;');
      console.log('%c Curious about the code? Check out my GitHub: https://github.com/SpitOnYourFace', 'font-size: 14px; color: #7a6f60;');
      console.log('%c Built with Astro, Tailwind CSS & TypeScript', 'font-size: 12px; color: #b0a898;');
    </script>
  </body>
</html>
